import { aggregateData, ApiData } from './aggregate.controller';

describe('aggregateController', () => {
  it('should aggregate data', () => {
    const inputData = {
      assetId1: {
        metric1: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19],
        metric2: [0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38],
        time: [
          '2021-06-09T18:10:00.000Z',
          '2021-06-09T18:11:00.000Z',
          '2021-06-09T18:12:00.000Z',
          '2021-06-09T18:13:00.000Z',
          '2021-06-09T18:14:00.000Z',
          '2021-06-09T18:15:00.000Z',
          '2021-06-09T18:16:00.000Z',
          '2021-06-09T18:17:00.000Z',
          '2021-06-09T18:18:00.000Z',
          '2021-06-09T18:19:00.000Z',
          '2021-06-09T18:20:00.000Z',
          '2021-06-09T18:21:00.000Z',
          '2021-06-09T18:22:00.000Z',
          '2021-06-09T18:23:00.000Z',
          '2021-06-09T18:24:00.000Z',
          '2021-06-09T18:25:00.000Z',
          '2021-06-09T18:26:00.000Z',
          '2021-06-09T18:27:00.000Z',
          '2021-06-09T18:28:00.000Z',
          '2021-06-09T18:29:00.000Z',
        ],
      },
      assetId2: {
        metric1: [0, 3, 6, 9, 12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51, 54, 57],
        metric2: [20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40, 42, 44, 46, 48, 50, 52, 54, 56, 58],
        time: [
          '2021-06-09T18:10:00.000Z',
          '2021-06-09T18:11:00.000Z',
          '2021-06-09T18:12:00.000Z',
          '2021-06-09T18:13:00.000Z',
          '2021-06-09T18:14:00.000Z',
          '2021-06-09T18:15:00.000Z',
          '2021-06-09T18:16:00.000Z',
          '2021-06-09T18:17:00.000Z',
          '2021-06-09T18:18:00.000Z',
          '2021-06-09T18:19:00.000Z',
          '2021-06-09T18:20:00.000Z',
          '2021-06-09T18:21:00.000Z',
          '2021-06-09T18:22:00.000Z',
          '2021-06-09T18:23:00.000Z',
          '2021-06-09T18:24:00.000Z',
          '2021-06-09T18:25:00.000Z',
          '2021-06-09T18:26:00.000Z',
          '2021-06-09T18:27:00.000Z',
          '2021-06-09T18:28:00.000Z',
          '2021-06-09T18:29:00.000Z',
        ],
      },
    } as unknown as ApiData;
    const period = 10;
    expect(aggregateData(period, inputData)).toEqual({
      assetId1: {
        metric1: [4.5, 14.5],
        metric2: [9, 29],
        time: ['2021-06-09T18:14:30.000Z', '2021-06-09T18:24:30.000Z']
      },
      assetId2: {
        metric1: [13.5, 43.5],
        metric2: [29, 49],
        time: ['2021-06-09T18:14:30.000Z', '2021-06-09T18:24:30.000Z']
      }
    });
  });

  it('should aggreagate empty array', () => {
    const inputData = {
      assetId1: {
        metric1: [],
        metric2: [],
        time: [],
      },
      assetId2: {
        metric1: [],
        metric2: [],
        time: [],
      }
    };
    const period = 30;    
    expect(aggregateData(period, inputData)).toEqual({
      assetId1: {
        metric1: [],
        metric2: [],
        time: []
      },
      assetId2: {
        metric1: [],
        metric2: [],
        time: []
      }
    });
  });
})
